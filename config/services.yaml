# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices/configuration.html#application-related-configuration
parameters:
  catrobat.apk.dir:                     "%catrobat.pubdir%resources/apk/"
  catrobat.featuredimage.dir:           "%catrobat.pubdir%resources/featured/"
  catrobat.featuredimage.path:          "resources/featured/"
  catrobat.exampleimage.dir:            "%catrobat.pubdir%resources/example/"
  catrobat.exampleimage.path:           "resources/example/"
  catrobat.file.extract.dir:            "%kernel.project_dir%/public/resources/extract/"
  catrobat.file.extract.path:           "resources/extract/"
  catrobat.file.storage.dir:            "%kernel.project_dir%/public/resources/programs/"
  catrobat.file.storage.path:           "resources/programs/"
  catrobat.logs.dir:                    "%kernel.project_dir%/var/log/"
  catrobat.max_name_upload_size: 50
  catrobat.max_description_upload_size: 10000 # also change in src/Catrobat/Listeners/DescriptionValidator.php
  catrobat.max_notes_and_credits_upload_size:     3000
  catrobat.mediapackage.dir:            "%catrobat.pubdir%resources/mediapackage/"
  catrobat.mediapackage.path:           "resources/mediapackage/"
  catrobat.mediapackage.sample.dir:     "%catrobat.pubdir%tests/testdata/DataFixtures/MediaPackage/SampleMediaPackage/"
  catrobat.mediapackage.sample.path:    "tests/testdata/DataFixtures/MediaPackage/SampleMediaPackage/"
  catrobat.mediapackage.font.dir:  "%catrobat.pubdir%webfonts/fa-solid-900.ttf"
  catrobat.mediapackage.font.path: "webfonts/fa-solid-900.ttf"
  catrobat.pubdir:                      "%kernel.project_dir%/public/"
  catrobat.resources.dir:               "%kernel.project_dir%/public/resources/"
  catrobat.screenshot.dir:              "%catrobat.pubdir%resources/screenshots/"
  catrobat.screenshot.path:             "resources/screenshots/"
  catrobat.template.dir:                "%catrobat.pubdir%resources/templates/"
  catrobat.template.path:               "resources/templates/"
  catrobat.template.screenshot.dir:     "%catrobat.pubdir%resources/templates/screenshots/"
  catrobat.template.screenshot.path:    "resources/templates/screenshots/"
  catrobat.template.storage.dir:        "%kernel.project_dir%/public/resources/templates/"
  catrobat.template.storage.path:       "resources/templates/"
  catrobat.template.thumbnail.dir:      "%catrobat.pubdir%resources/templates/thumbnails/"
  catrobat.template.thumbnail.path:     "resources/templates/thumbnails/"
  catrobat.test.directory.source:       "%kernel.project_dir%/tests/testdata/DataFixtures/"
  catrobat.test.directory.target:       "%kernel.project_dir%/tests/testdata/DataFixtures/GeneratedFixtures/"
  catrobat.thumbnail.dir:               "%catrobat.pubdir%resources/thumbnails/"
  catrobat.thumbnail.path:              "resources/thumbnails/"
  catrobat.translations.dir:            "%kernel.project_dir%/translations"
  catrobat.upload.temp.dir:             "%catrobat.pubdir%resources/tmp/uploads/"
  catrobat.upload.temp.path:            "resources/tmp/uploads/"
  es_host:                              "%env(ES_HOST)%"
  es_port:                              "%env(ES_PORT)%"

  #      This can drastically improve DX by reducing the time to load classes
  container.dumper.inline_class_loader: true


services:

  security.acl.permission.map:
    class: Sonata\AdminBundle\Security\Acl\Permission\AdminPermissionMap

  # default configuration for services in *this* file
  _defaults:
    autowire: true      # Automatically injects dependencies in your services.
    autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    #
    # setup special, global auto wiring rules:
    #
    #   Here one can bind variable names to specific parameters or services. This allows dependency injection
    #   of specific strings or classes. E.g $kernel_root_dir used as parameter in an constructor signals the
    #   dependency service that the "kernel.root_dir" parameter string must be injected.
    #
    #   It is also possible to inject the ParameterBagInterface with which one has easy access to all defined parameters
    #
    bind:
      $kernel_root_dir: "%kernel.root_dir%"
      $catrobat_translation_dir: "%catrobat.translations.dir%"
      $catrobat_file_storage_dir: "%catrobat.file.storage.dir%"
      $catrobat_file_extract_dir: "%catrobat.file.extract.dir%"
      $program_finder: '@fos_elastica.finder.app_program'
      $user_finder: '@fos_elastica.finder.app_user'


  # ====================================================================================================================
  #  Catrobat:
  #              makes classes in src available to be used as services
  #              this creates a service per class whose id is the fully-qualified class name
  #
  #              Repositories and Managers need to be public!
  #
  App\Catrobat\:
    resource: '../src/Catrobat/*'

  App\Entity\:
    resource: '../src/Entity/*'

  App\Manager\:
    resource: '../src/Manager'
    public: true

  App\Repository\:
    resource: '../src/Repository'
    public: true

  App\Api\Services\:
    resource: '../src/Api/Services/*'
    public: true

  App\Commands\Helpers\RemixManipulationProgramManager:
    class: App\Commands\Helpers\RemixManipulationProgramManager
    public: true

  App\Catrobat\RemixGraph\RemixGraphManipulator:
    class: App\Catrobat\RemixGraph\RemixGraphManipulator
    public: true

  App\Catrobat\RemixGraph\RemixSubgraphManipulator:
    class: App\Catrobat\RemixGraph\RemixSubgraphManipulator
    public: true

  # ====================================================================================================================
  #   Controllers:
  #                  controllers are imported separately to make sure they're public
  #                  and have a tag that allows actions to type-hint services
  #
  App\Controller\:
    resource: '../src/Controller'
    public: true

  App\Api_deprecated\Controller\:
    resource: '../src/Api_deprecated/Controller'
    public: true

  App\Admin\Users\UserDataReport\UserDataReportController:
    class: App\Admin\Users\UserDataReport\UserDataReportController
    public: true

  App\Admin\ApkGeneration\ApkController:
    class: App\Admin\ApkGeneration\ApkController
    public: true

  App\Admin\Tools\Maintenance\MaintainController:
    class: App\Admin\Tools\Maintenance\MaintainController
    public: true

  App\Admin\Tools\SendMailToUser\SendMailToUserController:
    class: App\Admin\Tools\SendMailToUser\SendMailToUserController
    public: true

  App\Admin\DB_Updater\Controller\:
    resource: '../src/Admin/DB_Updater/Controller'
    public: true

  App\Admin\Statistics\Translation\Controller\:
    resource: '../src/Admin/Statistics/Translation/Controller'
    public: true

  # ====================================================================================================================
  #   Commands:
  #               need a console tag; make sure all commands are in the correct folder and extend Command
  #
  App\Commands\:
    resource: '../src/Commands'
    exclude: '../src/Commands/Helpers'
    tags:
      - { name: console.command }


  # ====================================================================================================================
  #   Services:
  #                most services need to be public (mainly for testing -> easy access in SymfonySupport.php)
  #
  catroweb.jwt_token_refresh_service:
    class: App\Catrobat\Services\JWTTokenRefreshService
    public: true
    arguments: [ "@gesdinet.jwtrefreshtoken" ]

  App\Catrobat\Services\CatrobatFileSanitizer:
    class: App\Catrobat\Services\CatrobatFileSanitizer
    public: true

  App\Catrobat\Services\CatroNotificationService:
    class: App\Catrobat\Services\CatroNotificationService
    public: true

  App\Repository\ProgramFileRepository:
    class: App\Repository\ProgramFileRepository
    public: true

  App\Repository\ExtractedFileRepository:
    class: App\Repository\ExtractedFileRepository
    public: true

  App\Repository\ImageRepository:
    class: App\Repository\ImageRepository
    public: true

  App\Repository\MediaPackageFileRepository:
    class: App\Repository\MediaPackageFileRepository
    public: true

  App\Repository\ApkRepository:
    class: App\Repository\ApkRepository
    public: true

  App\Catrobat\Services\ProgramDevicePermissionReader:
    class: App\Catrobat\Services\ProgramDevicePermissionReader
    public: true

  App\Catrobat\Services\CatrobatFileCompressor:
    class: App\Catrobat\Services\CatrobatFileCompressor
    public: true

  App\Catrobat\Services\TokenGenerator:
    class: App\Catrobat\Services\TokenGenerator
    public: true

  App\Catrobat\CatrobatCode\Parser\CatrobatCodeParser:
    class: App\Catrobat\CatrobatCode\Parser\CatrobatCodeParser
    public: true

  App\Catrobat\Requests\AppRequest:
    class: App\Catrobat\Requests\AppRequest
    public: true

  App\Utils\ElapsedTimeStringFormatter:
    class: App\Utils\ElapsedTimeStringFormatter
    public: true

  App\Catrobat\Services\Ci\JenkinsDispatcher:
    class: App\Catrobat\Services\Ci\JenkinsDispatcher
    arguments:
      - "%jenkins%"
    public: true

  App\Api_deprecated\Security\ApiTokenAuthenticator:
    class: App\Api_deprecated\Security\ApiTokenAuthenticator
    public: true

  App\WebView\WebviewAuthenticator:
    class: App\WebView\WebviewAuthenticator
    public: true

  App\WebView\WebviewJWTAuthenticator:
    class: App\WebView\WebviewJWTAuthenticator
    public: true

  App\Catrobat\Services\CookieService:
    class: App\Catrobat\Services\CookieService
    arguments:
      - '%env(JWT_TTL)%'
      - '%env(REFRESH_TOKEN_TTL)%'
    public: true

  App\Catrobat\Services\RefreshTokenService:
    class: App\Catrobat\Services\RefreshTokenService
    arguments:
      - '%env(REFRESH_TOKEN_TTL)%'
    public: true

  App\Catrobat\Services\AsyncHttpClient:
    class: App\Catrobat\Services\AsyncHttpClient
    arguments:
      - timeout: 8.0
      - max_number_of_total_requests: 12
      - max_number_of_concurrent_requests: 4
    public: true

  App\Utils\MyUuidGenerator:
    class: App\Utils\MyUuidGenerator
    public: true

  # =============== Stuff that needs different parameters/services based on the environment

  App\Catrobat\Services\CatrobatFileExtractor:
    class: App\Catrobat\Services\CatrobatFileExtractor
    arguments:
      - "%catrobat.file.extract.dir%"
      - "%catrobat.file.extract.path%"
    public: true


  # ====================================================================================================================
  #   Twig
  #
  App\WebView\Twig\AppExtension:
    class: App\WebView\Twig\AppExtension
    tags:
      - { name: twig.extension }


  # ====================================================================================================================
  #   Event Subscribers
  #
  App\EventListener\ProjectPostUpdateNotifier:
    tags:
      - { name: 'doctrine.orm.entity_listener', event: 'postUpdate', entity: 'App\Entity\Program' }

  App\EventListener\UserPostPersistNotifier:
    tags:
      - { name: 'doctrine.orm.entity_listener', event: 'postPersist', entity: 'App\Entity\User' }

  App\EventListener\UserPostUpdateNotifier:
    tags:
      - { name: 'doctrine.orm.entity_listener', event: 'postUpdate', entity: 'App\Entity\User' }

  # ====================================================================================================================
  #   Listeners:
  #

  catroweb.jwt_authentication_success_listener:
    class: App\Catrobat\Listeners\JWTAuthenticationSuccessListener
    arguments:
      - "@gesdinet.jwtrefreshtoken.send_token"
    tags:
      - { name: kernel.event_listener, event: lexik_jwt_authentication.on_authentication_success, method: onAuthenticationSuccess }

  catroweb.oauth_success_listener:
    class: App\Catrobat\Listeners\OAuthSuccessListener

  # ======== System Validation ========

  catrowebbundle.listener.refresh_token:
    class: App\Catrobat\Listeners\JWTTokenListener
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 200 }

  catrowebbundle.listener.language:
    class: App\Catrobat\Listeners\LanguageListener
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 100 }

  catrowebbundle.listener.themeRequest:
    class: App\Catrobat\Listeners\ThemeRequestListener
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 10  }

  # ======== Upload Validation ========

  catroweb.file.validator.name:
    class: App\Catrobat\Listeners\NameValidator
    tags:
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\ProgramBeforeInsertEvent,
        method: onProgramBeforeInsert
      }

  catroweb.file.validator.description:
    class: App\Catrobat\Listeners\DescriptionValidator
    tags:
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\ProgramBeforeInsertEvent ,
        method: onProgramBeforeInsert
      }

  catroweb.file.validator.notesandcredits:
    class: App\Catrobat\Listeners\NotesAndCreditsValidator
    tags:
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\ProgramBeforeInsertEvent ,
        method: onProgramBeforeInsert
      }

  catroweb.file.validator.languageversion:
    class: App\Catrobat\Listeners\VersionValidator
    tags:
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\ProgramBeforeInsertEvent ,
        method: onProgramBeforeInsert
      }

  catroweb.file.validator.xmlheadervalidator:
    class: App\Catrobat\Listeners\ProgramXmlHeaderValidator
    tags:
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\ProgramBeforeInsertEvent ,
        method: onProgramBeforeInsert
      }

  # ======== Upload Modification ========

  catroweb.file.license.updater:
    class: App\Catrobat\Listeners\LicenseUpdater
    tags:
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\ProgramBeforeInsertEvent,
        method: onProgramBeforeInsert,
        priority: -1
      }

  catroweb.file.remix.updater:
    class: App\Catrobat\Listeners\RemixUpdater
    tags:
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\ProgramAfterInsertEvent,
        method: onProgramAfterInsert
      }

  catroweb.flavor.check:
    class: App\Catrobat\Listeners\ProgramFlavorListener
    tags:
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\ProgramBeforePersistEvent,
        method: onEvent
      }

  catroweb.apk.cleanup:
    class: App\Catrobat\Listeners\ApkCleanupListener
    tags:
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\ProgramBeforePersistEvent,
        method: handleEvent
      }

  catroweb.extension.check:
    class: App\Catrobat\Listeners\ProgramExtensionListener
    tags:
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\ProgramBeforePersistEvent,
        method: onEvent
      }

  # ======== Logging ========

  catrobat.core.services.invalidprogramuploadlogger:
    class:  App\Catrobat\Listeners\InvalidProgramUploadLogger
    tags:
      - { name: monolog.logger, channel: upload }
      - {
        name: kernel.event_listener,
        event: App\Catrobat\Events\InvalidProgramUploadedEvent,
        method: onInvalidProgramUploadedEvent
      }

  monolog.formatter.catrobat_custom_formatter:
    class: Monolog\Formatter\LineFormatter
    arguments:
      - "[%%datetime%%] %%channel%%.%%level_name%%: %%message%% %%context%%
      [Client IP: %%extra.client_ip%%, User Agent: %%extra.user_agent%%, Session User: %%extra.session_user%%]\n"
    calls:
      - [ includeStacktraces ]

  App\Logger\LoggerProcessor:
    tags:
      - { name: monolog.processor }

  # ======== Scratch ========
  catrobat.scratch.check:
    class: App\Catrobat\Listeners\ScratchProgramUpdater
    tags:
      - { name: kernel.event_listener, event: App\Catrobat\Events\CheckScratchProgramEvent, method: onCheckScratchProgram }

  # ======== Project Downloads ========
  App\EventSubscriber\ProjectDownloadEventSubscriber:
    class: App\EventSubscriber\ProjectDownloadEventSubscriber
    tags:
      - { name: kernel.event_subscriber }

  # ======== Entity ========

  catrobat.entity.featured.image_listener:
    class: App\Catrobat\Listeners\Entity\FeaturedProgramImageListener
    tags:
      - { name: doctrine.orm.entity_listener }

  catrobat.entity.example.image_listener:
    class: App\Catrobat\Listeners\Entity\ExampleProgramImageListener
    tags:
      - { name: doctrine.orm.entity_listener }

  # ======== Views ========
  catrobat.view.programlist:
    class: App\Api_deprecated\Listeners\ProgramListSerializer
    tags:
      - { name: kernel.event_listener, event: kernel.view, method: onKernelView }

  # ======== Versioning ========

  catrobat.versioning:
    class: App\Utils\VersionStrategy
    arguments:
      - '%env(string:APP_VERSION)%'

  # ====================================================================================================================
  # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  # ====================================================================================================================

  # ====================================================================================================================
  #  Sonata Admin Blocks
  #

  # ===== Projects

  admin.block.projects.overview:
    class: App\Admin\Projects\ProjectsAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Projects Overview", show_mosaic_button: false}
    arguments:
      - ~
      - App\Entity\Program
      - ~
    public: true

  admin.block.projects.approve:
    class: App\Admin\Projects\ApproveProjects\ApproveProjectsAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Approve Projects" }
    arguments:
      - ~
      - App\Entity\Program
      - App\Admin\Projects\ApproveProjects\ApproveProjectsController
    public: true

  admin.block.projects.reported:
    class: App\Admin\Projects\ReportedProjects\ReportedProjectsAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Reported Projects" }
    arguments:
      - ~
      - App\Entity\ProgramInappropriateReport
      - App\Admin\Projects\ReportedProjects\ReportedProjectsController
    public: true

  # ===== Comments

  admin.block.comments.overview:
    class: App\Admin\Comments\CommentsAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Comments Overview", show_mosaic_button: false}
    arguments:
      - ~
      - App\Entity\UserComment
      - ~
    public: true

  admin.block.comments.reported:
    class: App\Admin\Comments\ReportedComments\ReportedCommentsAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Reported Comments" }
    arguments:
      - ~
      - App\Entity\UserComment
      - App\Admin\Comments\ReportedComments\ReportedCommentsController
    public: true

  # ===== Special Projects

  admin.block.featured.program:
    class: App\Admin\SpecialProjects\FeaturedProgramAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Featured Projects" }
    arguments:
      - ~
      - App\Entity\FeaturedProgram
      - ~
    public: true

  admin.block.example.program:
    class: App\Admin\SpecialProjects\ExampleProgramAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Example Projects" }
    arguments:
      - ~
      - App\Entity\ExampleProgram
      - ~
    public: true

  # ===== Media Package

  admin.block.mediapackage.package:
    class: App\Admin\MediaPackage\MediaPackageAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Packages" }
    arguments:
      - ~
      - App\Entity\MediaPackage
      - ~
    public: true

  admin.block.mediapackage.category:
    class: App\Admin\MediaPackage\MediaPackageCategoriesAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Categories" }
    arguments:
      - ~
      - App\Entity\MediaPackageCategory
      - App\Admin\MediaPackage\MediaPackageCategoryController
    public: true

  admin.block.mediapackage.file:
    class: App\Admin\MediaPackage\MediaPackageFileAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Files" }
    arguments:
      - ~
      - App\Entity\MediaPackageFile
      - ~
    public: true

  # ===== Apk Generation

  admin.block.apk.pending:
    class: App\Admin\ApkGeneration\ApkPendingAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Pending" }
    arguments:
      - ~
      - App\Entity\Program
      - App\Admin\ApkGeneration\ApkController
    public: true

  admin.block.apk.list:
    class: App\Admin\ApkGeneration\ApkReadyAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Ready" }
    arguments:
      - ~
      - App\Entity\Program
      - App\Admin\ApkGeneration\ApkController
    public: true

  # ===== Users

  admin.block.users.overview:
    class: App\Admin\Users\UserAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: 'User overview', show_mosaic_button: false }
    arguments:
      - ~
      - App\Entity\User
      - ~

  admin.block.users.data_report:
    class: App\Admin\Users\UserDataReport\UserDataReportAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "User Data Report" }
    arguments:
      - ~
      - App\Entity\User
      - App\Admin\Users\UserDataReport\UserDataReportController
    public: true

  admin.block.users.reported:
    class: App\Admin\Users\ReportedUsers\ReportedUsersAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Reported Users", pager_type: "simple" }
    arguments:
      - ~
      - App\Entity\User
      - App\Admin\Users\ReportedUsers\ReportedUsersController
    public: true


  # ===== Survey

  admin.block.survey:
    class: App\Admin\Survey\AllSurveysAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "All Surveys", pager_type: "simple",
          icon: '<i class="fa fa-cogs"></i>' }
    arguments:
      - ~
      - App\Entity\Survey
      - ~
    public: true

  # ===== DB Updater

  admin.block.special_updater:
    class: App\Admin\DB_Updater\SpecialUpdaterAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Special Updater", icon: '<i class="fa fa-cogs"></i>' }
    arguments:
      - ~
      - ~
      - App\Admin\DB_Updater\Controller\SpecialUpdaterAdminController
    public: true

  admin.block.cron_jobs:
    class: App\Admin\DB_Updater\CronJobsAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Cron Jobs", icon: '<i class="fa fa-hourglass"></i>' }
    arguments:
      - ~
      - App\Entity\CronJob
      - App\Admin\DB_Updater\Controller\CronJobsAdminController
    public: true

  admin.block.achievements:
    class: App\Admin\DB_Updater\AchievementsAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Achievements" }
    arguments:
      - ~
      - App\Entity\Achievements\Achievement
      - App\Admin\DB_Updater\Controller\AchievementsAdminController
    public: true


  admin.block.extensions:
    class: App\Admin\DB_Updater\ExtensionsAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Extensions" }
    arguments:
      - ~
      - App\Entity\Extension
      - App\Admin\DB_Updater\Controller\ExtensionsAdminController
    public: true

  admin.block.tags:
    class: App\Admin\DB_Updater\TagsAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Tags" }
    arguments:
      - ~
      - App\Entity\Tag
      - App\Admin\DB_Updater\Controller\TagsAdminController
    public: true

  # ===== Tools

  admin.block.tools.maintain:
    class: App\Admin\Tools\Maintenance\MaintainAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Maintain",
          icon: '<i class="fa fa-cogs"></i>' }
    arguments:
      - ~
      - ~
      - App\Admin\Tools\Maintenance\MaintainController
    public: true

  admin.block.tools.logs:
    class: App\Admin\Tools\Logs\LogsAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Logs",
          icon: '<i class="fa fa-cogs"></i>' }
    arguments:
      - ~
      - ~
      - App\Admin\Tools\Logs\LogsController
    public: true

  admin.block.tools.broadcast:
    class: App\Admin\Tools\BroadcastNotification\BroadcastNotificationAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Broadcast Notification" }
    arguments:
      - ~
      - App\Entity\BroadcastNotification
      - App\Admin\Tools\BroadcastNotification\BroadcastNotificationController
    public: true

  admin.block.tools.mail:
    class: App\Admin\Tools\SendMailToUser\SendMailToUserAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Send Mail to User" }
    arguments:
      - ~
      - ~
      - App\Admin\Tools\SendMailToUser\SendMailToUserController
    public: true

  # ====================================================================================================================
  # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  # ====================================================================================================================

  # ====================================================================================================================
  #  CAPI:
  #        We need to register the API server as handler for our open api generated APIs
  #
  OpenAPI\Server\Service\SerializerInterface: "@open_api_server.service.serializer"

  api.media-library:
    class: App\Api\MediaLibraryApi
    tags:
      - { name: "open_api_server.api", api: "mediaLibrary" }

  api.projects:
    class: App\Api\ProjectsApi
    tags:
      - { name: "open_api_server.api", api: "projects" }

  api.user:
    class: App\Api\UserApi
    tags:
      - { name: "open_api_server.api", api: "user" }

  api.authentication:
    class: App\Api\AuthenticationApi
    tags:
      - { name: "open_api_server.api", api: "authentication" }

  api.utility:
    class: App\Api\UtilityApi
    tags:
      - { name: "open_api_server.api", api: "utility" }

  #=====================================================================================================================
  # HWIOAUTH
  #=====================================================================================================================
  my.oauth_aware.user_provider.service:
    class: App\Catrobat\Security\FOSUBUserProviderAdapter
    arguments:
      - '@App\Manager\UserManager'
      - {google: google_id, facebook: facebook_id, apple: apple_id}

  App\Translation\ItranslateApi:
    class: App\Translation\ItranslateApi
    arguments:
      - '@eight_points_guzzle.client.itranslate'

  App\Translation\GoogleTranslateApi:
    class: App\Translation\GoogleTranslateApi
    arguments:
      - '@Google\Cloud\Translate\V2\TranslateClient'

  Google\Cloud\Translate\V2\TranslateClient:

  App\Translation\TranslationDelegate:
    class: App\Translation\TranslationDelegate
    arguments:
      - '@App\Repository\ProjectCustomTranslationRepository'
      - '@App\Translation\ItranslateApi'
      - '@App\Translation\GoogleTranslateApi'

  App\Translation\MachineTranslationListener:
    class: App\Translation\MachineTranslationListener
    tags:
      - { name: kernel.event_listener, event: kernel.terminate, method: onTerminateEvent }

  admin.block.statistics.project_machine_translation:
    class: App\Admin\Statistics\Translation\ProjectMachineTranslationAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Project Machine Translation" }
    arguments:
      - ~
      - App\Entity\Translation\ProjectMachineTranslation
      - App\Admin\Statistics\Translation\Controller\ProjectMachineTranslationAdminController
    public: true

  admin.block.statistics.comment_machine_translation:
    class: App\Admin\Statistics\Translation\CommentMachineTranslationAdmin
    tags:
      - { name: sonata.admin, manager_type: orm, label: "Comment Machine Translation" }
    arguments:
      - ~
      - App\Entity\Translation\CommentMachineTranslation
      - App\Admin\Statistics\Translation\Controller\CommentMachineTranslationAdminController
    public: true
