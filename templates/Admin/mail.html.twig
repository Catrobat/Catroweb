{% extends base_template %}

{% block list_table %}

  <style>
    h3
    {
      margin-left: 20px;
    }

    p
    {
      margin-left: 20px;
    }

    .mtable
    {
      display: table;
      margin-left: 20px;
      margin-bottom: 30px;
      width: 95%;
    }

    .row-title
    {
      width: 100px;
      line-height: 28px;
      display: table-row;
      float: left;
      clear: both;
    }

    .row-button-mt
    {
      margin-top: -15px;
      display: table-row;
      float: left;
      margin-bottom: 10px;
      width: 500px;
    }

    .row-button
    {
      display: table-row;
      float: left;
      margin-bottom: 10px;
      width: 100%;
      max-width: 500px;
    }

    .row-result
    {
      margin-top: 5px;
      display: table-row;
      float: left;
      margin-bottom: 10px;
      width: 100%;
      max-width: 500px;
    }

    .row-button-mt-input
    {
      width: 100%;
    }

    .row-button-mt-textarea
    {
      width: 100%;
      min-height: 100px;
    }

    .error
    {
      color: red;
    }

    .success
    {
      color: green;
    }
  </style>


  <div class="col-xs-12 col-md-12">
    <div class="box box-primary">
      <div class="box-body table-responsive no-padding">

        <h3>Send Email</h3>

        <p>This tool allows you to send Emails to Users.</p>

        <div class="mtable">
          <div class="row-title">
            User Name:
          </div>
          <div class="row-button-mt">
            <label for="username"></label>
            <input id="username" type="text" class="row-button-mt-input"/>
          </div>

          <div class="row-title">
            Subject:
          </div>
          <div class="row-button-mt">
            <label for="subject"></label>
            <input id="subject" class="row-button-mt-input"/>
          </div>

          <div class="row-title">
            Content:
          </div>
          <div class="row-button-mt">
            <label for="content"></label>
            <textarea id="content" class="row-button-mt-textarea"></textarea>
          </div>

          <div class="row-title">
            Submit:
          </div>
          <div class="row-button">
            <input type="button" class="btn" value="Send notification"/>
          </div>

          <div class="row-title">
            Result:
          </div>
          <div class="row-result resultBox error">

          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    $('.btn').click(function () {

      let username = $('#username').val()
      let subject = $('#subject').val()
      let message = $('#content').val()
      let resultBox = $('.resultBox')

      // calls _/Controller/Admin/EmailUserMessageController::sendAction
      $.get('send', { username: username, subject: subject, message: message }, function (data) {
        if (data && data.length >= 2 && data.substring(0, 2) === 'OK')
        {
          resultBox.switchClass('error', 'success')
        }
        else
        {
          resultBox.switchClass('success', 'error')
        }
        resultBox.html(data)
      })
    })
  </script>
{% endblock %}
