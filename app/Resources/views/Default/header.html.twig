<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{{ path('index') }}">
                <img style="height:100%;" src="{{ asset('images/logo/logo_text.png') }}" alt="Pocket Code Logo" />
            </a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

            {% if not isWebview() %}
                <ul class="nav navbar-nav navbar-left">
                    <li><a href="http://play.google.com/store/apps/details?id=org.catrobat.catroid" target="_blank">{{ "googlePlay"|trans({}, "catroweb") }}</a></li>
                    <li><a href="{{ url('catrobat_web_help') }}">{{ "tutorials"|trans({}, "catroweb") }}</a></li>
                    <li><a href="http://www.catrobat.org" target="_blank">{{ "aboutPocketCode"|trans({}, "catroweb") }}</a></li>
                </ul>
                {% if false %}
                    {% include ':social:social_like_header.html.twig' %}
                {% endif %}
            {% endif %}
            <div class="row">
                <div class="col-md-4 col-lg-4">
                    <form class="navbar-form navbar-right" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control"  placeholder="{{ "search.dotdotdot"|trans({}, "catroweb") }}">
                        </div>
                        <button type="submit" class="btn btn-default">Submit</button>
                    </form>
                </div>
                <div class="col-md-1 col-lg-1">
                    {% if app.user %}
                        <div class="btn btn-menu logged-in show-nav-dropdown user-notification-badge">
                            <div class="img-avatar" {%  if app.user.avatar is not empty %}style="background-size:cover; background-position:center; outline: 1px solid #FFFFFF; background-image:url({{ app.user.avatar }});"{%  endif %}></div>
                        </div>
                        <div class="btn btn-username show-nav-dropdown">{{ app.user.username }}</div>
                        <div class="btn show-nav-dropdown">
                            <div class="img-dropdownArrow"></div>
                        </div>
                    {% else %}
                        <a href="{{ url('login') }}" id="btn-login">
                            <div class="btn btn-menu">
                                <div class="img-avatar"></div>
                            </div>
                        </a>
                    {% endif %}
                </div>
            </div>



        </div>
    </div>
</nav>

<nav>
    {% if not isWebview() %}
        <div id="fb-root"></div>
        <div id="header-top">

            {% include ':social:social_like_header.html.twig' %}

            <div><a href="http://play.google.com/store/apps/details?id=org.catrobat.catroid" target="_blank">{{ "googlePlay"|trans({}, "catroweb") }}</a></div>
            <div><a href="{{ url('catrobat_web_help') }}">{{ "tutorials"|trans({}, "catroweb") }}</a></div>
            <div><a href="http://www.catrobat.org" target="_blank">{{ "aboutPocketCode"|trans({}, "catroweb") }}</a></div>
        </div>

    {% endif %}

    <div id="header-left">
        <div id="logo">
            <a href="{{ path('index') }}">
            </a>
        </div>
        <input id="searchbar" class="input-search" placeholder="{{ "search.dotdotdot"|trans({}, "catroweb") }}">
    </div>

    <div id="header-right">
        <div id="menu">
            <div class="btn btn-search">
                <div id="search-header" class="img-magnifying-glass"></div>
            </div>
            <div>
                <input id="search-input-header" placeholder="{{ "search.dotdotdot"|trans({}, "catroweb") }}" class="size-large input-search">
            </div>

            {% if app.user %}
                <div class="btn btn-menu logged-in show-nav-dropdown user-notification-badge">
                    <div class="img-avatar" {%  if app.user.avatar is not empty %}style="background-size:cover; background-position:center; outline: 1px solid #FFFFFF; background-image:url({{ app.user.avatar }});"{%  endif %}></div>
                </div>
                <div class="btn btn-username show-nav-dropdown">{{ app.user.username }}</div>
                <div class="btn show-nav-dropdown">
                    <div class="img-dropdownArrow"></div>
                </div>
            {% else %}
                <a href="{{ url('login') }}" id="btn-login">
                    <div class="btn btn-menu">
                        <div class="img-avatar"></div>
                    </div>
                </a>
            {% endif %}

        </div>

        <div id="menu-mobile">
            <div class="btn btn-search">
                <div id="search-header-mobile" class="img-magnifying-glass"></div>
                <div class="img-undo-search"></div>
            </div>
            <div class="margin-spacer"></div>
            {% if app.user %}
                {% if app.user.avatar is not empty %}
                    <div id="custom-avatar" class="btn btn-menu show-nav-dropdown user-notification-badge">
                        <div style="background-image:url({{ app.user.avatar }});">
                            <div class="img-dropdownArrow-mobile"></div>
                        </div>
                    </div>
                {% else %}
                    <div class="btn btn-menu show-nav-dropdown user-notification-badge">
                        <div class="img-avatar"></div>
                    </div>
                {% endif %}
            {% else %}
                <a href="{{ url('login') }}" id="btn-login">
                    <div class="btn btn-menu">
                        <div class="img-avatar"></div>
                    </div>
                </a>
            {% endif %}
        </div>

    </div>

    {% if app.user %}
        <div id="nav-dropdown" class="img-nav-dropdown">
            <div id="nav-menu-item-user-notifications" style="border-bottom: 1px #FFFFFF solid">
                <a href="{{ path('user_notifications') }}">
                    <div><div class="img-dashboard user-notification-badge"></div></div>
                    <div>{{ "notifications"|trans({}, "catroweb") }}</div>
                </a>
            </div>
            <div>
                <a href="{{ url('profile') }}" id="btn-profile">
                    <div><div class="img-author-big"></div></div>
                    <div>{{ "My Profile"|trans({}, "catroweb") }}</div>
                </a>
            </div>
            {% if is_granted('ROLE_ADMIN') %}
                <div>
                    <a href="{{ url('sonata_admin_dashboard') }}" id="btn-admin">
                        <div><div class="img-dashboard"></div></div>
                        <div>Admin</div>
                    </a>
                </div>
            {% endif %}
            <div>
                <a href="{{ url('logout') }}" id="btn-logout">
                    <div><div class="img-logout"></div></div>
                    <div>{{ "Logout"|trans({}, "catroweb") }}</div>
                </a>
            </div>
        </div>
        <div id="user-notification-center"></div>
    {% endif %}
</nav>

{% if app.user %}
    <script>
        function fetchUserNotifications() {
            $.ajax({
                url: "{{ path('user_notifications_count') }}",
                type: "get",
                success: function(data) {
                    var numOfNotifications = data.count;
                    $(".user-notification-badge").removeAttr("data-badge");

                    if (numOfNotifications > 0) {
                        var labelTitle = (numOfNotifications <= 1000) ? numOfNotifications.toString() : "1000+";

                        if (labelTitle.length >= 3) {
                            $(".user-notification-badge").addClass("user-notification-badge-large");
                        } else {
                            $(".user-notification-badge").removeClass("user-notification-badge-large");
                        }
                        $(".user-notification-badge").attr("data-badge", labelTitle);
                    }
                    setTimeout(fetchUserNotifications, 10000);
                },
                error: function() { console.error("Unable to fetch user notifications!"); }
            });
        }

        $(document).ready(function() {
            fetchUserNotifications();
        });
    </script>
{% endif %}
